## 故障等级 {#id-故障处理流程-3.1故障等级划分}

根据故障对业务的影响，通常会涉及到：

1）存储集群全局故障，IO无法访问，这将导致这个云平台无法正常工作；或者网络全局故障，导致整个云平台虚拟机陷入瘫痪状态。这类故障通常为最严重的故障，而这类故障通常情况下不会，也不允许发生。

2）虚拟机由于平台及代码缺陷，异常停机；或者面板功能失效，无法创建，删除虚机，云硬盘，网络等。这类故障通常成为局部性故障，虽然影响到了客户业务，但是该影响仅在一台虚机，一个子网，或者某个组件API失效，这些都将不会对故障范围外的其他业务与组件造成影响。除此之外，还有一类故障需要严肃对待，就是可能即将引发全局故障的故障，例如出现一个 Ceph Monitor Down 的情况，这个时候如果在出现一个 Ceph Monitor Down 的情况，将可能引发全局故障；或者一个网络节点异常，这个时候，如果再有一个网络节点异常，很可能就会导致大面积虚机网络不通，造成全局性网络故障。

3）由于平台环境中的各个组件，通常都有高可用设计，而这时候局部组件的损坏不会导致业务不可用。比如 OpenStack API 服务故障，如果相同的 API 服务故障，那么该组件就将无法正常提供服务；或者存储集群中的某个 OSD 故障，当再损坏一个 OSD 后，可能即将引发全局故障；再比如虚拟机 fd 数量达到限制数量的 90%，预计在将来某一时刻，引发虚拟机故障，导致虚拟机不可用。上面描述的故障，在一定条件下，都将可能上升为 P2 等级故障。

4）Ceph Health Warn 报告集群被设置为 noout，nobackfill，当前情况下并不产生故障，但可能在将来一段时间内，更快的引发P1，P2 类的故障。

故障其实可以分更多的等级，为了使等级划分清晰明了，并且具有可执行性。根据上述分析，基本可以将故障分为如下四个等级：

| 故障等级 | 描述 |
| :--- | :--- |
| P1 —— Highest | 全局故障，业务大面积中断 —— 一般只发生在存储或网络中断时 |
| P2 —— High | 局部业务故障，或可能即将引发全局故障 |
| P3 —— Medium | 局部组件故障，或即将引发局部业务故障 |
| P4 —— Low | 警告，可能一定程度上影响稳定运行与性能，或可能引发局部组件故障 |

## 故障分类 {#id-故障处理流程-3.1故障等级划分}

| OpenStack | Ceph | 硬件 | 其他 |
| :--- | :--- | :--- | :--- |
| Nova | MON | CPU | 文件系统 |
| Cinder | OSD | 内存 | 网络路由 |
| Glance | MDS | 网卡 | .... |
| Neutron |  | 磁盘 | 等 |
| Keystone |  | 阵列卡 |  |
| Ceilometer |  | 交换机 |  |



