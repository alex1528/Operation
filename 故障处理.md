## 故障定义

故障（Failure）是指服务或设备在运行过程中，因为某种原因导致丧失规定功能或产生安全危害的现象。原因可能是由于硬件异常，操作系统异常，代码缺陷等。

## 故障等级 {#id-故障处理流程-3.1故障等级划分}

根据故障对业务的影响，通常会涉及到：

1）存储集群全局故障，IO无法访问，这将导致这个云平台无法正常工作；或者网络全局故障，导致整个云平台虚拟机陷入瘫痪状态。这类故障通常为最严重的故障，而这类故障通常情况下不会，也不允许发生。

2）虚拟机由于平台及代码缺陷，异常停机；或者面板功能失效，无法创建，删除虚机，云硬盘，网络等。这类故障通常成为局部性故障，虽然影响到了客户业务，但是该影响仅在一台虚机，一个子网，或者某个组件API失效，这些都将不会对故障范围外的其他业务与组件造成影响。除此之外，还有一类故障需要严肃对待，就是可能即将引发全局故障的故障，例如出现一个 Ceph Monitor Down 的情况，这个时候如果在出现一个 Ceph Monitor Down 的情况，将可能引发全局故障；或者一个网络节点异常，这个时候，如果再有一个网络节点异常，很可能就会导致大面积虚机网络不通，造成全局性网络故障。

3）由于平台环境中的各个组件，通常都有高可用设计，而这时候局部组件的损坏不会导致业务不可用。比如 OpenStack API 服务故障，如果相同的 API 服务故障，那么该组件就将无法正常提供服务；或者存储集群中的某个 OSD 故障，当再损坏一个 OSD 后，可能即将引发全局故障；再比如虚拟机 fd 数量达到限制数量的 90%，预计在将来某一时刻，引发虚拟机故障，导致虚拟机不可用。上面描述的故障，在一定条件下，都将可能上升为 P2 等级故障。

4）Ceph Health Warn 报告集群被设置为 noout，nobackfill，当前情况下并不产生故障，但可能在将来一段时间内，更快的引发P1，P2 类的故障。

故障其实可以分更多的等级，为了使等级划分清晰明了，并且具有可执行性。根据上述分析，基本可以将故障分为如下四个等级：

| 故障等级 | 描述 |
| :--- | :--- |
| P1 —— Highest | 全局故障，业务大面积中断 —— 一般只发生在存储或网络中断时 |
| P2 —— High | 局部业务故障，或可能即将引发全局故障 |
| P3 —— Medium | 局部组件故障，或即将引发局部业务故障 |
| P4 —— Low | 警告，可能一定程度上影响稳定运行与性能，或可能引发局部组件故障 |

## 故障分类 {#id-故障处理流程-3.1故障等级划分}

| OpenStack | Ceph | 硬件 | 其他 |
| :--- | :--- | :--- | :--- |
| Nova | MON | CPU | 文件系统 |
| Cinder | OSD | 内存 | 网络路由 |
| Glance | MDS | 网卡 | .... |
| Neutron |  | 磁盘 | 等 |
| Keystone |  | 阵列卡 |  |
| Ceilometer |  | 交换机 |  |

## 故障来源

故障来源通常有两种途径：

* LMA 系统
  * Zabbix  监控告警（短信告警，邮件告警）
  * Grafana 可视化监控
  * ELK 日志分析系统
* 客户直接反馈

理论上讲，只要 LMA 系统足够完善，那么 LMA 收到告警通常在客户反馈之前，也就是说客户的故障反馈通常能够在相关告警中找到关联告警。如果客户反馈的故障无法关联到任何告警，那么我们就应该思考一下，是否存在相关的监控告警缺失。

故障关联，故障分类，故障分级应由高级运维人员负责，并且将对应故障分发至运维人员分析与处理。运维人员完成处理后，需要申请高级运维人员 review 与 verify 处理结果，通过后结束后，完成故障处理报告。

## 运维人员

### 运维工程师 {#id-运维职级规范与协助流程-运维工程师}

职能：负责一线运维任务

* 运维问题收集整理：关注监控，告警，收集并整理当前系统状况，潜在风险和已出现问题
* 运维工艺实现：按照运维方案，实现相关运维任务需要使用到的脚本
* 运维工艺实施：实施被核准的运维工艺流程，并解决相关问题

流程：

1. 运维工程师遇到相关运维任务需要处理，必须根据当前运维任务，在对应项目中建立jira，明确阐述： 问题现象 —— 包括但不限于：当前状态，日志，以及其他相关命令工具获取的信息
2. 运维工程师能够自行提出解决方案，并且申请高级运维工程师review核准方案是否可以被执行。运维工程师不能够自行提出解决方案，直接申请高级运维工程师的支持。 ——  任务指派给他的直属上级（高级运维工程师）
3. 运维工程师等待高级运维工程师问题的解决思路，相关参考文档后 —— 高级运维工程师将任务指回到任务直接处理者，并回到步骤2。 如果运维解决方案通过审核，高级运维工程师将任务指回到运维工程师，并进入步骤4
4. 经过多次2，3步骤后，最终确认运维工艺实施方案，运维工程师必须严格按照被核准的运维方案，（可选：实现自动化运维脚本）并对运维工艺进行实施
5. 实施完成后，运维工程师应该提供相关处理日志，以及处理后的相关状态检查，并对这些信息进行备案，记入jira任务中后，点击完成任务，并流转至高级运维工程师审核
6. 高级运维工程师检查任务备案，并确认核准该任务流转完成

### 高级运维工程师 {#id-运维职级规范与协助流程-高级运维工程师}

职能：负责二线运维任务 —— 通常情况下，高级运维工程师必须担任过运维工程师的工作，有丰富的一线运维经验，并且具有极强的安全运维意识。除特殊关键任务变更与新工艺试点外，高级运维工程师不必参与工艺实施的工作，工艺实施通常由运维工程师执行。

* 高级运维问题处理：根据运维故障，制定可靠的运维流程及实施工艺
* 运维指导：指导运维工程师完成初级运维任务
* 运维培训：能够给予运维工程师相关培训（包括：运维工程师任务执行流程，相关运维工具及cli命令行工具使用，以及集群，服务器，进程状态，日志收集方式）
* 紧急任务处理：一级故障导致集群完全不可用，高级运维工程师需带领相关运维工程师共同处理，并快速解决故障
* 申请研发支持：有权申请研发支持，协助分析和解决相关疑难问题

流程：

1. 运维工程师收集到问题后，会指向其直属的高级运维工程师，高级运维工程师根据运维工程师反馈的情况，做出不同决定：
   1. 运维工程师采集，反馈数据不全面，高级运维工程师在jira提出进一步数据采集需求，并将任务指回运维工程师
   2. 根据运维工程师反馈的情况，审核其提供的工艺实施流程，并决定是否核准实施。如果未被核准，需给予运维工程师相关建议与指导，令其修改工艺实施流程，并将任务指回至运维工程师
   3. 运维工程师不具备相关运维经验，向高级运维工程师寻求帮助。此时，高级运维工程师应给予相关文档，链接，知识依赖进行参考与学习，及相关思路后，将任务指回至运维工程师，运维工程师需根据高级运维工程师提供的相关帮助，独立制定工艺实施流程后，申请再次审核。
2. 运维工程师收集到问题后，判断为故障可能为相关BUG导致，搜索并查询issue tracker是否已经有相关BUG记录。如果没有，将任务指向相关研发Leader，寻求协助，并由研发Leader将任务指向相关人员进行处理
3. 研发根据运维工程师与高级运维工程师提供的信息，分析，复现，并给出相应的解决方案后。将任务指回高级运维工程师，并有高级运维工程师协助运维工程师共同进行工艺实施任务



### 资深运维工程师 {#id-运维职级规范与协助流程-资深运维工程师}

职能：负责运维自动化，智能化任务。通过整理，整合，及维护运维自动化脚本，并周期性的review，refine相关运维实施工艺，降低运维门槛，提升运维高级运维工程师与运维工程师的效率 

