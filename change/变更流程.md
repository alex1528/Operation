# 变更流程

![](/assets/变更流程.jpg)

## 1. 变更输入

**哪些事情会触发变更流程：**

* **来自故障管理**

  故障处理过程中，需要对系统做变更的，遵循变更流程

* **来自问题管理**

  问题管理中，针对问题（Problem，临时解决方案）和已知错误（Known Error，永久解决方案），需要对系统做变更以修复问题和错误的，遵循变更流程

* **来自升级需求**

  升级可以认为是一种特殊的变更，遵循变更流程

**变更的输入：**

* **配置变更**

  配置由运维组负责，并通过 CMDB 配置管理数据库统一管理，参见 CMDB 章节

* **软件包变更**

  软件包由 release management team 负责和统一管理，遵循发布管理规范和流程

## 2. 变更请求发起

变更流程的开端，即提交一个变更请求。

由**变更发起人员**创建 JIRA ISSUE 和变更单

* JIRA ISSUE assign 给变更 owner

* 变更单格式：JIRA ISSUE + Gerrit Patch，参照变更单规范中的要求和样例

* 如果是自动变更，Gerrit Patch 中要包含自动执行代码、测试代码、回滚代码、CMDB 更新代码（以便将变更后的系统配置信息更新到 CMDB），以及与 JIRA 的交互代码（以便将流程中的关键点信息反馈到 JIRA）

* 如果是人工变更，则在 JIRA 中定义清楚变更操作步骤、风险回退方案

## 3. 变更请求审核

由**变更管理委员会成员**对变更请求进行审核（人工审核）。

审核的结果为通过或者不通过：

* 审核通过，进入测试流程

* 审核不通过，可以修改后重新发起请求，或者放弃变更

如果放弃变更，则变更中止，由变更 owner 关闭JIRA ISSUE（附 comments，中止原因）。

## 4. 变更测试

由**测试人员或 Robot **对变更进行测试。

* 如果是手工变更操作，使用 Infra提供的测试环境，由测试人员做变更测试

* 如果是自动变更操作，使用 Infra 提供的测试环境，运行自动化脚本做变更测试

测试的结果为通过或者不通过：

* 测试通过，则可执行变更

* 测试不通过，则需要修改之后重新发起请求，或者放弃变更

如果放弃变更，则变更中止，由变更 owner 关闭JIRA ISSUE（附 comments，中止原因）。

## 5. 变更执行

变更执行需要遵循变更操作规范，且严格按照变更单来执行，不允许随意对变更单的任何内容做修改。手工变更过程需录屏以备验证；自动变更过程需输出日志以备验证。

由**执行人员或 Robot **对变更进行执行。

* 如果是手工变更操作，由执行人员进行变更执行

* 如果是自动变更操作，运行自动化脚本做变更测试（离线环境还需要执行人员将变更的配置或软件包同步到客户环境中再执行）

执行的结果为成功或者不成功：

* 执行成功，则进入验证流程

* 执行不成功，则需要按照风险预案进行回退操作

## 6. 变更执行

当变更执行不成功或者变更结果不符合预期时，需要进行变更回退。

由**执行人员或 Robot **对变更进行回退。

回退操作：

* 回退操作成功，系统恢复变更前状态，变更中止，变更 owner 关闭 JIRA ISSUE（附 comments，中止原因）

* 回退操作失败，系统未能恢复变更前状态，则进入故障处理流程，变更中止，变更 owner 关闭 JIRA ISSUE（附 comments，中止原因）

## 7. 变更验证

由**变更验证人员**对变更进行验证。

验证分为两方面，变更结果成功与否的验证和变更过程合规性的验证。变更结果验证通过对比验证结果是否符合变更单中的变更预期结果来确定；合规性验证通过录屏或日志来确定。

变更结果验证

* 验证结果符合预期，则进入合规性验证

* 验证结果不符合预期，说明变更不成功，进入回退操作

变更合规性验证

* 合规性验证后，记录合规性验证结果，变更结束

_【待讨论】：变更合规性验证是每次变更都要实时做完才结束变更流程，还是说验证是事后的，验证素材存档以供定期抽查审计和变更出现问题时查看。_

## 8. 变更结束和输出

由**变更 owner **结束一个变更。

合规性验证之后，变更结束

* 更新 CMDB 信息

* 关闭 JIRA ISSUE （附 comments，如果不满足合规性要求，需要在 JIRA 中备注说明）



